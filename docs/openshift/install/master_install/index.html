<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.37.1" />
    <meta name="description" content="openshift origin 开源容器云 Ops Solution">
<meta name="author" content="HunterFu 北方人">
<meta name="keywords" content="openshift master,架构,docker,部署环境">
<meta http-equiv="content-language" content="zh-CN" />

    <link rel="shortcut icon" href="/openshift/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/openshift/images/favicon.png" type="image/x-icon" />
    <title>主服务安装 :: OpsSoluiton 开源方案</title>
    
    
    <link href="/openshift/css/nucleus.css?1542631209" rel="stylesheet">
    <link href="/openshift/css/font-awesome.min.css?1542631209" rel="stylesheet">
    <link href="/openshift/css/hybrid.css?1542631209" rel="stylesheet">
    <link href="/openshift/css/featherlight.min.css?1542631209" rel="stylesheet">
    <link href="/openshift/css/perfect-scrollbar.min.css?1542631209" rel="stylesheet">
    <link href="/openshift/css/auto-complete.css?1542631209" rel="stylesheet">
    <link href="/openshift/css/theme.css?1542631209" rel="stylesheet">
    <link href="/openshift/css/hugo-theme.css?1542631209" rel="stylesheet">
    
      <link href="/openshift/css/theme-mine.css?1542631209" rel="stylesheet">
    

    <script src="/openshift/js/jquery-2.x.min.js?1542631209"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7322741757959159",
    enable_page_level_ads: true
  });
</script>


  </head>
  <body class="" data-url="/install/master_install/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/openshift/">
<img src="/openshift/images/logo.png" alt="开源解决方案">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/openshift/js/lunr.min.js?1542631209"></script>
<script type="text/javascript" src="/openshift/js/auto-complete.js?1542631209"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="/openshift/js/search.js?1542631209"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/install/" title="集群安装" class="dd-item 
        parent
        
        
        ">
      <a href="/openshift/install/">
          <b>1. </b>集群安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/install/arch_intro/" title="架构介绍" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/arch_intro/">
          架构介绍
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/env_intro/" title="部署环境介绍" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/env_intro/">
          部署环境介绍
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/etcd_install/" title="Etcd集群安装" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/etcd_install/">
          Etcd集群安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/master_install/" title="主服务安装" class="dd-item 
        parent
        active
        
        ">
      <a href="/openshift/install/master_install/">
          主服务安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/haproxy_install/" title="Haproxy安装" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/haproxy_install/">
          Haproxy安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/node_install/" title="计算节点安装" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/node_install/">
          计算节点安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/router_registry_install/" title="Router And Registry安装" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/router_registry_install/">
          Router And Registry安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/metric_install/" title="度量系统安装" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/metric_install/">
          度量系统安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/efk_install/" title="EFK日志系统安装" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/efk_install/">
          EFK日志系统安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/harbor_install/" title="Harbor Docker仓库安装" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/harbor_install/">
          Harbor Docker仓库安装
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/install/ceph_install/" title="单容器版CEPH集群" class="dd-item 
        
        
        
        ">
      <a href="/openshift/install/ceph_install/">
          单容器版CEPH集群
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/application/" title="应用部署" class="dd-item 
        
        
        
        ">
      <a href="/openshift/application/">
          <b>2. </b>应用部署
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/application/import_template/" title="导入示例模板" class="dd-item ">
        <a href="/openshift/application/import_template/">
        导入示例模板
        <i class="fa fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/application/ceph_persistent/" title="应用数据持久化(CEPH)" class="dd-item 
        
        
        
        ">
      <a href="/openshift/application/ceph_persistent/">
          应用数据持久化(CEPH)
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/application/s2i_custom/" title="S2I Build 镜像制作" class="dd-item 
        
        
        
        ">
      <a href="/openshift/application/s2i_custom/">
          S2I Build 镜像制作
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/application/deploy_app_cboard/" title="手工部署应用实战" class="dd-item 
        
        
        
        ">
      <a href="/openshift/application/deploy_app_cboard/">
          手工部署应用实战
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/application/create_template/" title="创建应用模板" class="dd-item 
        
        
        
        ">
      <a href="/openshift/application/create_template/">
          创建应用模板
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/monitor/" title="平台监控" class="dd-item 
        
        
        
        ">
      <a href="/openshift/monitor/">
          <b>3. </b>平台监控
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/appcenter/" title="组件中心" class="dd-item 
        
        
        
        ">
      <a href="/openshift/appcenter/">
          <b>4. </b>组件中心
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/appcenter/nexus3/" title="Nexus 3.x私服使用" class="dd-item 
        
        
        
        ">
      <a href="/openshift/appcenter/nexus3/">
          Nexus 3.x私服使用
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/appcenter/custom_category/" title="定制 Catalog 分类" class="dd-item 
        
        
        
        ">
      <a href="/openshift/appcenter/custom_category/">
          定制 Catalog 分类
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/security/" title="平台安全" class="dd-item 
        
        
        
        ">
      <a href="/openshift/security/">
          <b>5. </b>平台安全
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/devops/" title="开发运维" class="dd-item 
        
        
        
        ">
      <a href="/openshift/devops/">
          <b>6. </b>开发运维
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/faq/" title="常见问题" class="dd-item 
        
        
        
        ">
      <a href="/openshift/faq/">
          <b>7. </b>常见问题
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
       
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fa fa-fw fa-history"></i> Clear History</a></li>         
      
      </ul>
    </section>
    
    <section id="footer">
      <center>
      <p><a href="https://github.com/hunterfu/51know/issues/1/#new_comment_field">有意见和建议,欢迎留言反馈</a></p>
      <p>Built with <a href="http://gohugo.io/">Hugo</a> and <a href="https://github.com/matcornic/hugo-theme-learn">learn theme</a></i></p>
      <p><a href="https://www.51know.info">
      <img src="/openshift/images/showcase/icon_opensource.png">
      </a></p>
</center>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/openshift/'>红帽 OpenShift</a> > <a href='/openshift/install/'>集群安装</a> > 主服务安装
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#部署主机角色说明">部署主机角色说明</a></li>
<li><a href="#安装前基础环境检查">安装前基础环境检查</a>
<ul>
<li><a href="#配置仓库源-如果自己建立本地源-直接跳过本步骤">配置仓库源(如果自己建立本地源 直接跳过本步骤)</a></li>
</ul></li>
<li><a href="#安装第一个master节点软件包">安装第一个master节点软件包</a>
<ul>
<li><a href="#权限登录配置">权限登录配置</a>
<ul>
<li><a href="#超级admin用户登陆配置说明-只能命令行登陆">超级admin用户登陆配置说明(只能命令行登陆)</a></li>
</ul></li>
<li><a href="#webui-登陆用户配置">WEBUI 登陆用户配置</a></li>
</ul></li>
<li><a href="#其他2个master节点安装">其他2个master节点安装</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>主服务安装</h1>
          

        




<table>
<thead>
<tr>
<th>版本</th>
<th>日期</th>
<th>状态</th>
<th>修订人</th>
<th>摘要</th>
</tr>
</thead>

<tbody>
<tr>
<td>V1.0</td>
<td>2018-04-17</td>
<td>创建</td>
<td>开源方案</td>
<td>初始版本</td>
</tr>
</tbody>
</table>

<h2 id="部署主机角色说明">部署主机角色说明</h2>

<table>
<thead>
<tr>
<th>主机角色</th>
<th>IP地址</th>
<th>负载域名</th>
</tr>
</thead>

<tbody>
<tr>
<td>管理节点(Master)</td>
<td>openshift-master1(192.168.124.22)</td>
<td>openshift.ops.com</td>
</tr>

<tr>
<td>管理节点(Master)</td>
<td>openshift-master2(192.168.124.23)</td>
<td>openshift.ops.com</td>
</tr>

<tr>
<td>管理节点(Master)</td>
<td>openshift-master3(192.168.124.24)</td>
<td>openshift.ops.com</td>
</tr>
</tbody>
</table>

<h2 id="安装前基础环境检查">安装前基础环境检查</h2>

<h3 id="配置仓库源-如果自己建立本地源-直接跳过本步骤">配置仓库源(如果自己建立本地源 直接跳过本步骤)</h3>

<ul>
<li>安装仓库源文件</li>
</ul>

<pre><code>yum install centos-release-openshift-origin.noarch
</code></pre>

<ul>
<li>修改仓库配置 指向 V3.6版本(默认是指向最新的版本)</li>
</ul>

<pre><code>[root@openshift-master ~]# cat /etc/yum.repos.d/CentOS-OpenShift-Origin.repo
[centos-openshift-origin]
name=CentOS OpenShift Origin
baseurl=http://mirrors.163.com/centos/7/paas/x86_64/openshift-origin36/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-PaaS
其他省略。。。。。。。。
</code></pre>

<p>主要是把
<strong><a href="http://mirror.centos.org/centos/7/paas/x86_64/openshift-origin/">http://mirror.centos.org/centos/7/paas/x86_64/openshift-origin/</a></strong>
修改为下面链接(使用163镜像)
<strong><a href="http://mirrors.163.com/centos/7/paas/x86_64/openshift-origin36/">http://mirrors.163.com/centos/7/paas/x86_64/openshift-origin36/</a></strong></p>

<h2 id="安装第一个master节点软件包">安装第一个master节点软件包</h2>

<ul>
<li>安装 origin-master</li>
</ul>

<pre><code>yum install  origin-master -y
</code></pre>

<ul>
<li>由于yum安装的master节点的证书不包含对外负载域名(openshift.ops.com),所以需要重新签发证书,并删除默认node配置</li>
</ul>

<pre><code>openshift start master --public-master='https://openshift.ops.com'   --network-plugin='redhat/openshift-ovs-subnet' --write-config=/etc/origin/master
rm -fr /etc/origin/node
</code></pre>

<ul>
<li>查看证书生成的信息,DNS中会生成一个openshift.ops.com的域名</li>
</ul>

<pre><code>[root@openshift-master master]# openssl x509 -noout -text -in  master.server.crt
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 11 (0xb)
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=openshift-signer@1524139430
        Validity
            Not Before: Apr 19 12:06:27 2018 GMT
            Not After : Apr 18 12:06:28 2020 GMT
        Subject: CN=127.0.0.1
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:b1:93:7c:57:d5:e1:c1:2c:59:1a:28:9e:b0:df:
                    38:cc:de:ab:d3:ab:6a:fa:97:3a:f2:79:80:26:0b:
                    f0:92:7f:e3:e8:be:da:37:43:d0:f6:ce:d9:c1:e0:
                    a5:cb:cf:af:04:bb:a4:bc:84:2c:a4:97:08:d4:c1:
                    a5:d5:48:4f:3a:96:fb:2e:66:ad:6e:1f:d1:4a:8d:
                    21:c4:68:3d:f2:79:e2:3e:c5:e1:ee:78:2b:63:96:
                    d7:fa:f2:e8:b4:58:45:1c:ba:6c:ca:0f:4b:b3:cf:
                    26:95:43:fe:fa:43:88:a4:48:c7:4e:07:83:66:eb:
                    fe:48:78:f2:07:24:7c:a8:f4:6f:7b:80:5a:7e:7d:
                    0f:b2:87:46:5b:76:05:e2:d3:f0:58:87:69:64:5a:
                    17:91:70:6f:81:90:89:ac:65:57:cc:f2:67:8b:c7:
                    26:0d:79:b7:84:3f:58:ec:5c:d7:a2:85:17:36:e8:
                    62:86:6d:3d:21:43:38:cf:1c:2c:c4:c9:3d:6c:b4:
                    da:c3:0c:5e:ca:3f:74:ff:b7:39:1e:fb:63:bf:47:
                    66:54:54:8f:88:c3:8f:ba:a5:dd:70:ec:53:6a:ce:
                    49:48:77:1a:10:cc:81:bb:85:a4:55:b7:07:e9:fa:
                    7c:67:38:40:35:1c:bf:cf:ee:45:79:19:6b:69:45:
                    3d:0b
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage:
                TLS Web Server Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Subject Alternative Name:
                DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, DNS:localhost, DNS:openshift, DNS:openshift.default, DNS:openshift.default.svc, DNS:openshift.default.svc.cluster.local, DNS:openshift.ops.com, DNS:127.0.0.1, DNS:172.30.0.1, DNS:192.168.124.22, IP Address:127.0.0.1, IP Address:172.30.0.1, IP Address:192.168.124.22
    Signature Algorithm: sha256WithRSAEncryption
         d5:8b:11:66:64:0e:cc:b9:36:85:15:1f:75:02:d1:9b:5c:32:
         b5:af:1e:d9:38:85:e0:95:77:d7:5d:42:dd:e9:40:07:c8:d2:
         ae:4b:99:db:8f:61:49:e7:3b:37:4b:22:cc:0b:07:5d:6a:39:
         ce:82:e8:00:38:4e:af:14:1b:9c:78:6a:2e:58:b8:44:c0:62:
         96:18:7d:58:2c:9c:db:87:e3:47:20:61:97:7f:ae:3f:74:c5:
         4a:cc:88:e6:6b:1b:4c:b4:16:6d:66:99:4a:7f:bc:51:ec:b4:
         17:66:56:ab:d5:16:0f:a8:2b:8b:5c:dc:91:e1:bc:3b:99:41:
         5b:ad:cb:f0:52:20:23:93:46:44:de:cf:fe:70:27:ec:8d:eb:
         65:23:84:5d:cb:75:18:31:19:d9:0d:8c:43:0b:6f:c7:97:1e:
         02:41:d9:07:93:bb:b0:dc:53:08:54:0e:48:cc:1c:60:4d:87:
         c2:a8:be:56:55:af:53:62:21:29:2b:43:eb:38:45:f9:11:52:
         b6:d8:56:77:3d:a0:34:1c:69:3b:e1:3d:f9:85:46:f9:60:b9:
         2e:b4:b2:e2:54:a7:20:7a:a3:50:de:38:ad:4b:31:e3:45:2c:
         45:3a:b6:8c:a3:5f:80:47:97:f9:e8:2f:e6:b8:2d:11:55:3d:
         0a:6a:fc:18
</code></pre>

<ul>
<li>修改master etcd配置,使用前面配置好的etcd集群</li>
</ul>

<p>修改前</p>

<pre><code>[root@openshift-master master]# cat /etc/origin/master/master-config.yaml
.....省略.....
etcdClientInfo:
  ca: ca.crt
  certFile: master.etcd-client.crt
  keyFile: master.etcd-client.key
  urls:
  - https://192.168.124.22:4001
etcdConfig:
  address: 192.168.124.22:4001
  peerAddress: 192.168.124.22:7001
  peerServingInfo:
    bindAddress: 0.0.0.0:7001
    bindNetwork: tcp4
    certFile: etcd.server.crt
    clientCA: ca.crt
    keyFile: etcd.server.key
    namedCertificates: null
  servingInfo:
    bindAddress: 0.0.0.0:4001
    bindNetwork: tcp4
    certFile: etcd.server.crt
    clientCA: ca.crt
    keyFile: etcd.server.key
    namedCertificates: null
  storageDirectory: /etc/origin/openshift.local.etcd
etcdStorageConfig:
  kubernetesStoragePrefix: kubernetes.io
  kubernetesStorageVersion: v1
  openShiftStoragePrefix: openshift.io
  openShiftStorageVersion: v1
.....省略.....
</code></pre>

<p>修改后</p>

<pre><code>[root@openshift-master master]# cat /etc/origin/master/master-config.yaml
.....省略.....
etcdClientInfo:
  ca: master.etcd-ca.crt
  certFile: master.etcd-client.crt
  keyFile: master.etcd-client.key
  urls:
    - https://192.168.124.22:2379
    - https://192.168.124.23:2379
    - https://192.168.124.24:2379
etcdStorageConfig:
  kubernetesStoragePrefix: kubernetes.io
  kubernetesStorageVersion: v1
  openShiftStoragePrefix: openshift.io
  openShiftStorageVersion: v1
.....省略.....
</code></pre>

<ul>
<li>openshift配置与etcd的证书对应关系</li>
</ul>

<table>
<thead>
<tr>
<th>openshift证书名</th>
<th>etcd证书名</th>
</tr>
</thead>

<tbody>
<tr>
<td>master.etcd-ca.crt</td>
<td>etcd-root-ca.pem</td>
</tr>

<tr>
<td>master.etcd-client.crt</td>
<td>etcd.pem</td>
</tr>

<tr>
<td>master.etcd-client.key</td>
<td>etcd-key.pem</td>
</tr>
</tbody>
</table>

<ul>
<li>拷贝相关证书到master目录</li>
</ul>

<pre><code>[root@openshift-master master]# cat /etc/origin/master/master-config.yaml ^C
[root@openshift-master master]# cp /etc/etcd/etcd-root-ca.pem /etc/origin/master/master.etcd-ca.crt
[root@openshift-master master]# cp /etc/etcd/etcd.pem /etc/origin/master/master.etcd-client.crt
cp: overwrite ‘/etc/origin/master/master.etcd-client.crt’? y
[root@openshift-master master]# cp /etc/etcd/etcd-key.pem /etc/origin/master/master.etcd-client.key
cp: overwrite ‘/etc/origin/master/master.etcd-client.key’? y
</code></pre>

<ul>
<li>启动master</li>
</ul>

<pre><code>systemctl enable origin-master.service
systemctl start origin-master.service
</code></pre>

<h3 id="权限登录配置">权限登录配置</h3>

<h4 id="超级admin用户登陆配置说明-只能命令行登陆">超级admin用户登陆配置说明(只能命令行登陆)</h4>

<ul>
<li>admin 用户登陆使用密钥文件</li>
</ul>

<pre><code>/etc/origin/master/admin.kubeconfig
</code></pre>

<ul>
<li>管理员登陆 使用证书密钥进行管理(当前用户是root)</li>
</ul>

<pre><code>[root@openshift-master ~]# mkdir -p /root/.kube
[root@openshift-master ~]# cp /etc/origin/master/admin.kubeconfig    /root/.kube/config
[root@openshift-master ~]# oc login -u system:admin
Logged into &quot;https://192.168.124.22:8443&quot; as &quot;system:admin&quot; using existing credentials.

You have access to the following projects and can switch between them with 'oc project &lt;projectname&gt;':

  * default
    kube-public
    kube-system
    openshift
    openshift-infra

Using project &quot;default&quot;.
</code></pre>

<ul>
<li>执行 如下命令可以看到当前登录用户</li>
</ul>

<pre><code>[root@openshift-master ~]# oc whoami
system:admin
</code></pre>

<h3 id="webui-登陆用户配置">WEBUI 登陆用户配置</h3>

<ul>
<li>安装完默认是任意密码登陆，这里配置htpasswd方式进行认证</li>
</ul>

<p>修改前</p>

<pre><code>    provider:
      apiVersion: v1
      kind: AllowAllPasswordIdentityProvider
</code></pre>

<p>修改后</p>

<pre><code>    provider:
      apiVersion: v1
      kind: HTPasswdPasswordIdentityProvider
      file: /etc/origin/master/htpasswd
</code></pre>

<ul>
<li>安装htpasswd</li>
</ul>

<pre><code>[root@openshift-master master]# yum install httpd-tools -y
</code></pre>

<ul>
<li>添加ops账户</li>
</ul>

<pre><code>[root@openshift-master master]# htpasswd -c /etc/origin/master/htpasswd ops
New password:
Re-type new password:
Adding password for user ops
</code></pre>

<ul>
<li>将ops用户加入openshift-infra 和 default 项目，并赋予admin权限</li>
</ul>

<pre><code>[root@openshift-master master]# oc adm policy add-role-to-user admin ops -n openshift-infra
role &quot;admin&quot; added: &quot;ops&quot;
[root@openshift-master master]# oc adm policy add-role-to-user admin ops -n default
role &quot;admin&quot; added: &quot;ops&quot;
</code></pre>

<ul>
<li>重启master 节点</li>
</ul>

<pre><code>systemctl daemon-reload
systemctl restart origin-master
</code></pre>

<p>至此 第一个master节点安装部署完成</p>

<h2 id="其他2个master节点安装">其他2个master节点安装</h2>

<ul>
<li><p>参考第一个节点,配置仓库,安装 origin-master 软件包</p></li>

<li><p>将第一个master节点的 ca配置和相关配置文件拷贝到其他master节点上</p>

<pre><code>scp ca.* master.etcd-* htpasswd openshift-master2:/etc/origin/master
</code></pre></li>

<li><p>在其他2个节点重新生成配置</p>

<pre><code>openshift start master --public-master='https://openshift.ops.com'   --network-plugin='redhat/openshift-ovs-subnet' --write-config=/etc/origin/master
</code></pre></li>

<li><p>参考上文设置 超级admin用户登陆配置</p></li>

<li><p>启动master节点即可</p></li>

<li><p>检查日志,无错误,安装完成</p></li>
</ul>


<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/openshift/install/etcd_install/" title="Etcd集群安装"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/openshift/install/haproxy_install/" title="Haproxy安装" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/openshift/js/clipboard.min.js?1542631209"></script>
    <script src="/openshift/js/perfect-scrollbar.min.js?1542631209"></script>
    <script src="/openshift/js/perfect-scrollbar.jquery.min.js?1542631209"></script>
    <script src="/openshift/js/jquery.sticky.js?1542631209"></script>
    <script src="/openshift/js/featherlight.min.js?1542631209"></script>
    <script src="/openshift/js/html5shiv-printshiv.min.js?1542631209"></script>
    <script src="/openshift/js/highlight.pack.js?1542631209"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/openshift/js/modernizr.custom.71422.js?1542631209"></script>
    <script src="/openshift/js/learn.js?1542631209"></script>
    <script src="/openshift/js/hugo-learn.js?1542631209"></script>

    <link href="/openshift/mermaid/mermaid.css?1542631209" type="text/css" rel="stylesheet" />
    <script src="/openshift/mermaid/mermaid.js?1542631209"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0b8fb0a47cefc8f0c9cc5ebfa8e9b54a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </body>
</html>
